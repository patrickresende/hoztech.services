{% extends "admin/base.html" %}
{% load static %}

{% block dashboard_content %}
<div class="dashboard-container">
    <!-- Filtros -->
    <div class="dashboard-card">
        <h2>Filtros</h2>
        <form method="get" class="filter-form">
            <div class="filter-grid">
                <div class="filter-group">
                    <label for="domain">Domínio</label>
                    <input type="text" name="domain" id="domain" value="{{ request.GET.domain }}" class="form-control">
                </div>
                <div class="filter-group">
                    <label for="name">Nome do Cookie</label>
                    <input type="text" name="name" id="name" value="{{ request.GET.name }}" class="form-control">
                </div>
                <div class="filter-group">
                    <label for="date_from">Data Inicial</label>
                    <input type="date" name="date_from" id="date_from" value="{{ request.GET.date_from }}" class="form-control">
                </div>
                <div class="filter-group">
                    <label for="date_to">Data Final</label>
                    <input type="date" name="date_to" id="date_to" value="{{ request.GET.date_to }}" class="form-control">
                </div>
            </div>
            <div class="filter-actions">
                <button type="submit" class="export-button">
                    <i class="fas fa-filter"></i> Filtrar
                </button>
                <a href="?export=csv" class="export-button">
                    <i class="fas fa-file-csv"></i> Exportar CSV
                </a>
                <a href="?export=xlsx" class="export-button">
                    <i class="fas fa-file-excel"></i> Exportar Excel
                </a>
            </div>
        </form>
    </div>

    <!-- Lista de Cookies -->
    <div class="table-container">
        <h2>Cookies ({{ total_cookies }})</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Domínio</th>
                    <th>Valor</th>
                    <th>Expira</th>
                    <th>Sessão</th>
                    <th>Seguro</th>
                    <th>HttpOnly</th>
                    <th>SameSite</th>
                    <th>Criado</th>
                </tr>
            </thead>
            <tbody>
                {% for cookie in cookies %}
                <tr>
                    <td>{{ cookie.name }}</td>
                    <td>{{ cookie.domain }}</td>
                    <td>{{ cookie.value|truncatechars:30 }}</td>
                    <td>{{ cookie.expires|date:"d/m/Y H:i"|default:"Sessão" }}</td>
                    <td>{{ cookie.session.session_key|truncatechars:8 }}</td>
                    <td>
                        {% if cookie.secure %}
                        <i class="fas fa-check text-success"></i>
                        {% else %}
                        <i class="fas fa-times text-danger"></i>
                        {% endif %}
                    </td>
                    <td>
                        {% if cookie.httponly %}
                        <i class="fas fa-check text-success"></i>
                        {% else %}
                        <i class="fas fa-times text-danger"></i>
                        {% endif %}
                    </td>
                    <td>{{ cookie.samesite|default:"-" }}</td>
                    <td>{{ cookie.created_at|date:"d/m/Y H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Paginação -->
        {% if is_paginated %}
        <div class="pagination">
            {% if page_obj.has_previous %}
            <a href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">&laquo; Primeira</a>
            <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Anterior</a>
            {% endif %}

            <span class="current">
                Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Próxima</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Última &raquo;</a>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Estatísticas -->
    <div class="dashboard-card">
        <h2>Estatísticas de Cookies</h2>
        <div class="stats-grid">
            <div class="metric-card">
                <div class="metric-icon" style="background: rgba(37, 99, 235, 0.1); color: var(--primary-color);">
                    <i class="fas fa-cookie"></i>
                </div>
                <div class="metric-info">
                    <div class="metric-value">{{ total_cookies }}</div>
                    <div class="metric-label">Total de Cookies</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success-color);">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="metric-info">
                    <div class="metric-value">{{ secure_cookies }}</div>
                    <div class="metric-label">Cookies Seguros</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning-color);">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="metric-info">
                    <div class="metric-value">{{ session_cookies }}</div>
                    <div class="metric-label">Cookies de Sessão</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--danger-color);">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="metric-info">
                    <div class="metric-value">{{ unique_domains }}</div>
                    <div class="metric-label">Domínios Únicos</div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .filter-form {
        margin-bottom: 1rem;
    }

    .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .filter-group label {
        font-size: 0.875rem;
        color: #6b7280;
    }

    .filter-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th,
    .table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
    }

    .table th {
        background-color: #f9fafb;
        font-weight: 600;
    }

    .table tr:hover {
        background-color: #f9fafb;
    }
</style>
{% endblock %} 